<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>å–µæ˜Ÿäººæ—¥å¿—è¿‡æ»¤ç³»ç»Ÿ ğŸ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet"/>
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #FFE4E1 0%, #FFF8DC 100%);
            min-height: 100vh;
        }
        
        .cat-paw {
            cursor: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="%23FF69B4"><path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.9 1 3 1.9 3 3V21C3 22.1 3.9 23 5 23H19C20.1 23 21 22.1 21 21V9H21Z"/></svg>'), auto;
        }
        
        .floating-heart {
            position: absolute;
            color: #FFC0CB;
            animation: float 3s ease-in-out infinite;
            pointer-events: none;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.7; }
            50% { transform: translateY(-20px) rotate(180deg); opacity: 1; }
        }
        
        .gradient-text {
            background: linear-gradient(45deg, #FF69B4, #FFB6C1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .hover-lift {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(255, 182, 193, 0.3);
        }
        
        .loading-cat {
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #FFB6C1, #FF69B4);
            border-radius: 10px;
            height: 8px;
            transition: width 0.3s ease;
        }
        
        .chat-bubble {
            animation: slideInUp 0.5s ease-out;
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        #particles-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }
        
        .notification {
            transition: transform 0.3s ease;
        }
        
        .copy-btn {
            transition: all 0.2s ease;
        }
        
        .copy-btn:hover {
            transform: scale(1.1);
        }
        
        .log-entry {
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
        }
        
        .log-entry:hover {
            border-left-color: #ec4899;
            background-color: #fdf2f8;
        }
    </style>
</head>
<body class="cat-paw">
    <canvas id="particles-canvas"></canvas>
    
    <!-- å¯¼èˆªæ  -->
    <nav class="fixed top-0 w-full z-50 glass-effect">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-pink-500 rounded-full flex items-center justify-center text-white">ğŸ±</div>
                    <h1 class="text-xl font-bold gradient-text">å–µæ˜Ÿäººæ—¥å¿—è¿‡æ»¤ç³»ç»Ÿ</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="help-btn" class="px-4 py-2 bg-pink-100 text-pink-600 rounded-full hover:bg-pink-200 transition-colors">
                        ğŸ†˜ å¸®åŠ©
                    </button>
                    <button id="tutorial-btn" class="px-4 py-2 bg-pink-500 text-white rounded-full hover:bg-pink-600 transition-colors">
                        ğŸ“š æ•™ç¨‹
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- å¼€åœºåŠ¨ç”» -->
    <div id="loading-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-gradient-to-br from-pink-100 to-pink-200">
        <div class="text-center">
            <div class="loading-cat mb-6">
                <div class="w-32 h-32 mx-auto bg-pink-500 rounded-full flex items-center justify-center text-white text-6xl">ğŸ±</div>
            </div>
            <h2 class="text-2xl font-bold text-pink-600 mb-4">å–µæ˜Ÿäººæ­£åœ¨å‡†å¤‡ä¸­...</h2>
            <div class="w-64 h-2 bg-pink-100 rounded-full overflow-hidden mx-auto">
                <div id="loading-progress" class="progress-bar w-0"></div>
            </div>
            <p id="loading-text" class="text-pink-500 mt-2">åˆå§‹åŒ–çŒ«å’ªç³»ç»Ÿ...</p>
        </div>
    </div>

    <!-- ä¸»ç•Œé¢ -->
    <div id="main-content" class="pt-20 min-h-screen hidden">
        <!-- æ¬¢è¿æ¨ªå¹… -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-8">
            <div class="glass-effect rounded-2xl p-6 text-center hover-lift">
                <h2 class="text-3xl font-bold gradient-text mb-2">æ¬¢è¿æ¥åˆ°å–µæ˜Ÿäººæ—¥å¿—è¿‡æ»¤ç³»ç»Ÿï¼ğŸ±</h2>
                <p class="text-gray-600">è®©å¯çˆ±çš„çŒ«å’ªå¸®æ‚¨è¿‡æ»¤æ—¥å¿—ï¼Œé›†åˆè¿ç®—å˜å¾—ç®€å•æœ‰è¶£ï¼</p>
            </div>
        </div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
                <div class="lg:col-span-1 space-y-6">
                    <!-- æ–‡ä»¶ä¸Šä¼  -->
                    <div class="glass-effect rounded-2xl p-6 hover-lift">
                        <h3 class="text-xl font-semibold text-pink-600 mb-4 flex items-center">
                            ğŸ“ ä¸Šä¼ æ—¥å¿—æ–‡ä»¶
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">åº”ç”¨æ—¥å¿—</label>
                                <div class="border-2 border-dashed border-pink-300 rounded-lg p-4 text-center hover:border-pink-400 transition-colors">
                                    <input type="file" id="app-log-file" class="hidden" accept=".log,.txt"/>
                                    <div class="cursor-pointer" onclick="document.getElementById('app-log-file').click()">
                                        <div class="text-4xl mb-2">ğŸ“</div>
                                        <p class="text-pink-600">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ åº”ç”¨æ—¥å¿—</p>
                                    </div>
                                </div>
                                <div id="app-log-preview" class="mt-2 text-sm text-gray-600 hidden"></div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">æ•°æ®åº“æ—¥å¿—</label>
                                <div class="border-2 border-dashed border-pink-300 rounded-lg p-4 text-center hover:border-pink-400 transition-colors">
                                    <input type="file" id="db-log-file" class="hidden" accept=".log,.txt"/>
                                    <div class="cursor-pointer" onclick="document.getElementById('db-log-file').click()">
                                        <div class="text-4xl mb-2">ğŸ—„ï¸</div>
                                        <p class="text-pink-600">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ æ•°æ®åº“æ—¥å¿—</p>
                                    </div>
                                </div>
                                <div id="db-log-preview" class="mt-2 text-sm text-gray-600 hidden"></div>
                            </div>
                        </div>
                    </div>

                    <!-- å…³é”®è¯é…ç½® -->
                    <div class="glass-effect rounded-2xl p-6 hover-lift">
                        <h3 class="text-xl font-semibold text-pink-600 mb-4 flex items-center">
                            ğŸ” å…³é”®è¯è®¾ç½®
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    æ’é™¤å…³é”®è¯ 
                                    <span class="text-xs text-gray-500">(ç”¨é€—å·åˆ†éš”)</span>
                                </label>
                                <input type="text" id="exclude-keywords" placeholder="DEBUG,INFO,TRACE" class="w-full px-3 py-2 border border-pink-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-300"/>
                                <div class="mt-2 flex flex-wrap gap-1" id="exclude-tags"></div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    ä¿ç•™å…³é”®è¯ 
                                    <span class="text-xs text-gray-500">(ç”¨é€—å·åˆ†éš”)</span>
                                </label>
                                <input type="text" id="include-keywords" placeholder="ERROR,WARN,FATAL" class="w-full px-3 py-2 border border-pink-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-300"/>
                                <div class="mt-2 flex flex-wrap gap-1" id="include-tags"></div>
                            </div>
                            <div class="pt-2">
                                <label class="flex items-center">
                                    <input type="checkbox" id="enable-correlation" class="mr-2 text-pink-500"/>
                                    <span class="text-sm text-gray-700">å¯ç”¨å…³è”ç­›é€‰</span>
                                </label>
                                <div id="correlation-options" class="mt-3 hidden">
                                    <div class="text-sm text-gray-600 mb-2">å…³è”æ¡ä»¶ï¼š</div>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="checkbox" id="app-error" class="mr-2 text-pink-500" checked/>
                                            <span class="text-sm">åº”ç”¨æ—¥å¿—å« ERROR</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="db-connection" class="mr-2 text-pink-500" checked/>
                                            <span class="text-sm">æ•°æ®åº“æ—¥å¿—å« Connection</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- å¿«é€Ÿæ“ä½œ -->
                    <div class="glass-effect rounded-2xl p-6 hover-lift">
                        <h3 class="text-xl font-semibold text-pink-600 mb-4 flex items-center">
                            âš¡ å¿«é€Ÿæ“ä½œ
                        </h3>
                        <div class="space-y-3">
                            <button id="filter-btn" class="w-full bg-pink-500 text-white py-3 rounded-lg hover:bg-pink-600 transition-colors font-medium">
                                ğŸš€ å¼€å§‹è¿‡æ»¤
                            </button>
                            <button id="clear-btn" class="w-full bg-gray-200 text-gray-700 py-3 rounded-lg hover:bg-gray-300 transition-colors">
                                ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®
                            </button>
                            <button id="sample-btn" class="w-full bg-purple-200 text-purple-700 py-3 rounded-lg hover:bg-purple-300 transition-colors">
                                ğŸ² åŠ è½½ç¤ºä¾‹
                            </button>
                        </div>
                    </div>
                </div>

                <!-- å³ä¾§ç»“æœå±•ç¤º -->
                <div class="lg:col-span-2">
                    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                    <div class="glass-effect rounded-2xl p-6 mb-6 hover-lift">
                        <h3 class="text-xl font-semibold text-pink-600 mb-4 flex items-center">
                            ğŸ“Š å¤„ç†ç»Ÿè®¡
                        </h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-pink-600" id="total-logs">0</div>
                                <div class="text-sm text-gray-600">åŸå§‹æ—¥å¿—</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-pink-600" id="excluded-logs">0</div>
                                <div class="text-sm text-gray-600">å·²æ’é™¤</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-pink-600" id="filtered-logs">0</div>
                                <div class="text-sm text-gray-600">è¿‡æ»¤ç»“æœ</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-pink-600" id="correlation-pairs">0</div>
                                <div class="text-sm text-gray-600">å…³è”å¯¹æ•°</div>
                            </div>
                        </div>
                    </div>

                    <!-- ç»“æœæ ‡ç­¾é¡µ -->
                    <div class="glass-effect rounded-2xl p-6 hover-lift">
                        <div class="flex space-x-4 mb-6">
                            <button id="tab-single" class="px-4 py-2 bg-pink-500 text-white rounded-lg font-medium">
                                å•æ—¥å¿—ç»“æœ
                            </button>
                            <button id="tab-correlation" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300">
                                å…³è”ç»“æœ
                            </button>
                        </div>

                        <!-- å•æ—¥å¿—ç»“æœ -->
                        <div id="single-results" class="space-y-4">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="text-lg font-semibold text-gray-800">è¿‡æ»¤åçš„æ—¥å¿—</h4>
                                <div class="flex space-x-2">
                                    <button id="expand-all" class="px-3 py-1 bg-pink-100 text-pink-600 rounded text-sm hover:bg-pink-200">
                                        å±•å¼€å…¨éƒ¨
                                    </button>
                                    <button id="collapse-all" class="px-3 py-1 bg-pink-100 text-pink-600 rounded text-sm hover:bg-pink-200">
                                        æŠ˜å å…¨éƒ¨
                                    </button>
                                </div>
                            </div>
                            <div id="single-logs-container" class="space-y-2 max-h-96 overflow-y-auto">
                                <div class="text-center text-gray-500 py-8">
                                    <div class="text-4xl mb-2">ğŸ±</div>
                                    <p>è¿˜æ²¡æœ‰è¿‡æ»¤ç»“æœï¼Œå¿«ä¸Šä¼ æ—¥å¿—æ–‡ä»¶å¼€å§‹å§ï¼</p>
                                </div>
                            </div>
                        </div>

                        <!-- å…³è”ç»“æœ -->
                        <div id="correlation-results" class="hidden space-y-4">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="text-lg font-semibold text-gray-800">å…³è”æ—¥å¿—å¯¹</h4>
                                <div class="text-sm text-gray-600">
                                    æ˜¾ç¤º <span id="correlation-count">0</span> å¯¹å…³è”æ—¥å¿—
                                </div>
                            </div>
                            <div id="correlation-logs-container" class="space-y-3 max-h-96 overflow-y-auto">
                                <div class="text-center text-gray-500 py-8">
                                    <div class="text-4xl mb-2">ğŸ”—</div>
                                    <p>å¯ç”¨å…³è”ç­›é€‰åæ‰ä¼šæ˜¾ç¤ºç›¸å…³ç»“æœå“¦ï¼</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ™ºèƒ½æœºå™¨äººåŠ©æ‰‹ -->
    <div id="assistant" class="fixed bottom-6 right-6 z-40">
        <div id="assistant-button" class="w-16 h-16 bg-pink-500 rounded-full shadow-lg cursor-pointer hover:bg-pink-600 transition-colors flex items-center justify-center text-white text-2xl hover-lift">
            ğŸ¤–
        </div>
        <div id="chat-window" class="hidden fixed bottom-20 right-0 w-80 h-96 bg-white rounded-2xl shadow-2xl overflow-hidden">
            <div class="bg-pink-500 text-white p-4 flex justify-between items-center">
                <h3 class="font-semibold">å–µæ˜Ÿäººæ™ºèƒ½åŠ©æ‰‹</h3>
                <button id="close-chat" class="text-white hover:text-pink-200">âœ•</button>
            </div>
            <div id="chat-messages" class="h-64 overflow-y-auto p-4 space-y-2">
                <div class="chat-bubble bg-pink-50 p-3 rounded-lg">
                    <p class="text-sm">ä½ å¥½ï¼æˆ‘æ˜¯å–µæ˜Ÿäººæ™ºèƒ½åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå…³äºæ—¥å¿—è¿‡æ»¤çš„é—®é¢˜å¯ä»¥é—®æˆ‘å“¦ï½</p>
                </div>
            </div>
            <div class="p-4 border-t">
                <div class="flex space-x-2">
                    <input type="text" id="chat-input" placeholder="è¾“å…¥é—®é¢˜..." class="flex-1 px-3 py-2 border border-pink-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-300"/>
                    <button id="send-message" class="px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600">å‘é€</button>
                </div>
                <div class="mt-2 flex flex-wrap gap-1">
                    <button class="quick-question px-2 py-1 bg-pink-100 text-pink-600 rounded text-xs hover:bg-pink-200">æ€ä¹ˆä¸Šä¼ æ—¥å¿—</button>
                    <button class="quick-question px-2 py-1 bg-pink-100 text-pink-600 rounded text-xs hover:bg-pink-200">å…³é”®è¯è®¾ç½®</button>
                    <button class="quick-question px-2 py-1 bg-pink-100 text-pink-600 rounded text-xs hover:bg-pink-200">å…³è”ç­›é€‰</button>
                </div>
            </div>
        </div>
    </div>

    <!-- å¸®åŠ©å¼¹çª— -->
    <div id="help-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
        <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-pink-600">ä½¿ç”¨å¸®åŠ©</h2>
                <button id="close-help" class="text-gray-500 hover:text-gray-700">âœ•</button>
            </div>
            <div class="space-y-4 text-gray-700">
                <div>
                    <h3 class="font-semibold text-pink-600 mb-2">ğŸ“ ä¸Šä¼ æ—¥å¿—æ–‡ä»¶</h3>
                    <p>æ”¯æŒä¸Šä¼ åº”ç”¨æ—¥å¿—å’Œæ•°æ®åº“æ—¥å¿—æ–‡ä»¶ï¼Œæ”¯æŒ .log å’Œ .txt æ ¼å¼ã€‚</p>
                </div>
                <div>
                    <h3 class="font-semibold text-pink-600 mb-2">ğŸ” å…³é”®è¯è®¾ç½®</h3>
                    <p><strong>æ’é™¤å…³é”®è¯ï¼š</strong>åŒ…å«è¿™äº›è¯çš„æ—¥å¿—å°†è¢«è¿‡æ»¤æ‰</p>
                    <p><strong>ä¿ç•™å…³é”®è¯ï¼š</strong>åœ¨æ’é™¤åçš„ç»“æœä¸­ï¼Œåªä¿ç•™åŒ…å«è¿™äº›è¯çš„æ—¥å¿—</p>
                </div>
                <div>
                    <h3 class="font-semibold text-pink-600 mb-2">ğŸ”— å…³è”ç­›é€‰</h3>
                    <p>å¯ç”¨åå¯ä»¥ç­›é€‰å‡ºåº”ç”¨æ—¥å¿—å’Œæ•°æ®åº“æ—¥å¿—ä¹‹é—´çš„å…³è”å…³ç³»ã€‚</p>
                </div>
                <div>
                    <h3 class="font-semibold text-pink-600 mb-2">ğŸ“Š é›†åˆè¿ç®—åŸç†</h3>
                    <p><strong>å·®é›†è¿ç®—ï¼š</strong>åŸå§‹æ—¥å¿—é›† - æ’é™¤å…³é”®è¯æ—¥å¿—é›†</p>
                    <p><strong>äº¤é›†è¿ç®—ï¼š</strong>ç»“æœé›† âˆ© ä¿ç•™å…³é”®è¯æ—¥å¿—é›†</p>
                    <p><strong>ç¬›å¡å°”ç§¯ï¼š</strong>å¤šæ—¥å¿—æºçš„å…³è”ç­›é€‰</p>
                </div>
            </div>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="bg-white bg-opacity-50 mt-12 py-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-gray-600">Â© 2024 å–µæ˜Ÿäººæ—¥å¿—è¿‡æ»¤ç³»ç»Ÿ - è®©é›†åˆè¿ç®—å˜å¾—å¯çˆ±åˆæœ‰è¶£ï¼</p>
        </div>
    </footer>

    <script>
        // å®Œæ•´çš„JavaScriptä»£ç 
        class CatLogFilter {
            constructor() {
                this.appLogs = [];
                this.dbLogs = [];
                this.filteredLogs = [];
                this.correlationPairs = [];
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.initParticles();
                this.showLoadingScreen();
                this.initAssistant();
            }

            setupEventListeners() {
                // æ–‡ä»¶ä¸Šä¼ 
                document.getElementById('app-log-file').addEventListener('change', (e) => this.handleFileUpload(e, 'app'));
                document.getElementById('db-log-file').addEventListener('change', (e) => this.handleFileUpload(e, 'db'));

                // å…³é”®è¯è¾“å…¥
                document.getElementById('exclude-keywords').addEventListener('input', (e) => this.updateTags(e, 'exclude'));
                document.getElementById('include-keywords').addEventListener('input', (e) => this.updateTags(e, 'include'));

                // å…³è”ç­›é€‰
                document.getElementById('enable-correlation').addEventListener('change', (e) => {
                    document.getElementById('correlation-options').classList.toggle('hidden', !e.target.checked);
                });

                // æŒ‰é’®äº‹ä»¶
                document.getElementById('filter-btn').addEventListener('click', () => this.filterLogs());
                document.getElementById('clear-btn').addEventListener('click', () => this.clearData());
                document.getElementById('sample-btn').addEventListener('click', () => this.loadSampleData());

                // æ ‡ç­¾é¡µåˆ‡æ¢
                document.getElementById('tab-single').addEventListener('click', () => this.switchTab('single'));
                document.getElementById('tab-correlation').addEventListener('click', () => this.switchTab('correlation'));

                // å±•å¼€/æŠ˜å 
                document.getElementById('expand-all').addEventListener('click', () => this.toggleAllLogs(true));
                document.getElementById('collapse-all').addEventListener('click', () => this.toggleAllLogs(false));

                // å¸®åŠ©å’Œæ•™ç¨‹
                document.getElementById('help-btn').addEventListener('click', () => this.showHelp());
                document.getElementById('tutorial-btn').addEventListener('click', () => this.showTutorial());
                document.getElementById('close-help').addEventListener('click', () => this.hideHelp());

                // æ‹–æ‹½ä¸Šä¼ 
                this.setupDragAndDrop();
            }

            setupDragAndDrop() {
                const dropZones = document.querySelectorAll('.border-dashed');
                dropZones.forEach(zone => {
                    zone.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        zone.classList.add('border-pink-400', 'bg-pink-50');
                    });

                    zone.addEventListener('dragleave', () => {
                        zone.classList.remove('border-pink-400', 'bg-pink-50');
                    });

                    zone.addEventListener('drop', (e) => {
                        e.preventDefault();
                        zone.classList.remove('border-pink-400', 'bg-pink-50');
                        
                        const files = e.dataTransfer.files;
                        if (files.length > 0) {
                            const file = files[0];
                            const type = zone.querySelector('input').id.includes('app') ? 'app' : 'db';
                            this.processFile(file, type);
                        }
                    });
                });
            }

            async handleFileUpload(event, type) {
                const file = event.target.files[0];
                if (file) {
                    await this.processFile(file, type);
                }
            }

            async processFile(file, type) {
                const previewId = type === 'app' ? 'app-log-preview' : 'db-log-preview';
                const previewElement = document.getElementById(previewId);
                
                try {
                    const text = await this.readFileAsText(file);
                    const logs = text.split('\n').filter(line => line.trim());
                    
                    if (type === 'app') {
                        this.appLogs = logs;
                    } else {
                        this.dbLogs = logs;
                    }

                    previewElement.textContent = `å·²åŠ è½½ ${logs.length} è¡Œæ—¥å¿—`;
                    previewElement.classList.remove('hidden');
                    
                    this.updateStatistics();
                    
                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    this.showNotification(`æˆåŠŸåŠ è½½ ${file.name}`, 'success');
                } catch (error) {
                    previewElement.textContent = 'æ–‡ä»¶è¯»å–å¤±è´¥';
                    previewElement.classList.remove('hidden');
                    this.showNotification('æ–‡ä»¶è¯»å–å¤±è´¥', 'error');
                }
            }

            readFileAsText(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = e => resolve(e.target.result);
                    reader.onerror = e => reject(e);
                    reader.readAsText(file);
                });
            }

            updateTags(event, type) {
                const containerId = type === 'exclude' ? 'exclude-tags' : 'include-tags';
                const container = document.getElementById(containerId);
                const keywords = event.target.value.split(',').map(k => k.trim()).filter(k => k);
                
                container.innerHTML = '';
                keywords.forEach(keyword => {
                    if (keyword) {
                        const tag = document.createElement('span');
                        tag.className = 'px-2 py-1 bg-pink-100 text-pink-700 rounded-full text-xs';
                        tag.textContent = keyword;
                        container.appendChild(tag);
                    }
                });
            }

            filterLogs() {
                if (this.appLogs.length === 0 && this.dbLogs.length === 0) {
                    this.showNotification('è¯·å…ˆä¸Šä¼ æ—¥å¿—æ–‡ä»¶', 'warning');
                    return;
                }

                const excludeKeywords = document.getElementById('exclude-keywords').value
                    .split(',')
                    .map(k => k.trim())
                    .filter(k => k);
                
                const includeKeywords = document.getElementById('include-keywords').value
                    .split(',')
                    .map(k => k.trim())
                    .filter(k => k);

                // è¿‡æ»¤åº”ç”¨æ—¥å¿—
                let filteredAppLogs = this.appLogs.filter(log => {
                    // æ’é™¤åŒ…å«æ’é™¤å…³é”®è¯çš„æ—¥å¿—
                    if (excludeKeywords.some(keyword => log.includes(keyword))) {
                        return false;
                    }
                    // å¦‚æœè®¾ç½®äº†ä¿ç•™å…³é”®è¯ï¼Œåªä¿ç•™åŒ…å«è¿™äº›å…³é”®è¯çš„æ—¥å¿—
                    if (includeKeywords.length > 0) {
                        return includeKeywords.some(keyword => log.includes(keyword));
                    }
                    return true;
                });

                // è¿‡æ»¤æ•°æ®åº“æ—¥å¿—
                let filteredDbLogs = this.dbLogs.filter(log => {
                    if (excludeKeywords.some(keyword => log.includes(keyword))) {
                        return false;
                    }
                    if (includeKeywords.length > 0) {
                        return includeKeywords.some(keyword => log.includes(keyword));
                    }
                    return true;
                });

                this.filteredLogs = [...filteredAppLogs, ...filteredDbLogs];

                // å…³è”åˆ†æ
                if (document.getElementById('enable-correlation').checked) {
                    this.analyzeCorrelation(filteredAppLogs, filteredDbLogs);
                } else {
                    this.correlationPairs = [];
                }

                this.displayResults();
                this.updateStatistics();
                this.showNotification('æ—¥å¿—è¿‡æ»¤å®Œæˆï¼', 'success');
            }

            analyzeCorrelation(appLogs, dbLogs) {
                this.correlationPairs = [];
                
                // ç®€å•çš„å…³è”åˆ†æï¼šåŸºäºæ—¶é—´æˆ³æˆ–é”™è¯¯ID
                appLogs.forEach(appLog => {
                    dbLogs.forEach(dbLog => {
                        // æå–å¯èƒ½çš„æ—¶é—´æˆ³ï¼ˆç®€åŒ–ç‰ˆï¼‰
                        const appTime = this.extractTimestamp(appLog);
                        const dbTime = this.extractTimestamp(dbLog);
                        
                        // å¦‚æœæ—¶é—´æˆ³ç›¸è¿‘ï¼ˆåœ¨10ç§’å†…ï¼‰ï¼Œè®¤ä¸ºæ˜¯å…³è”çš„
                        if (appTime && dbTime && Math.abs(appTime - dbTime) < 10000) {
                            this.correlationPairs.push({
                                appLog,
                                dbLog,
                                timestamp: appTime
                            });
                        }
                    });
                });
            }

            extractTimestamp(log) {
                // ç®€å•çš„æ—¥æœŸæ—¶é—´æå–ï¼ˆå®é™…é¡¹ç›®ä¸­éœ€è¦æ›´å¤æ‚çš„è§£æï¼‰
                const timestampRegex = /\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}/;
                const match = log.match(timestampRegex);
                if (match) {
                    return new Date(match[0]).getTime();
                }
                return null;
            }

            displayResults() {
                this.displaySingleLogs();
                this.displayCorrelationLogs();
            }

            displaySingleLogs() {
                const container = document.getElementById('single-logs-container');
                
                if (this.filteredLogs.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-gray-500 py-8">
                            <div class="text-4xl mb-2">ğŸ±</div>
                            <p>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ—¥å¿—è®°å½•</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = '';
                this.filteredLogs.forEach((log, index) => {
                    const logElement = document.createElement('div');
                    logElement.className = 'log-entry bg-white rounded-lg p-3 border border-pink-100 hover:border-pink-300 transition-colors';
                    logElement.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="text-sm text-gray-600 mb-1">æ—¥å¿— #${index + 1}</div>
                                <div class="text-gray-800 font-mono text-sm break-all">${this.escapeHtml(log)}</div>
                            </div>
                            <button class="ml-2 text-pink-500 hover:text-pink-700 copy-btn" data-log="${this.escapeHtml(log)}">
                                ğŸ“‹
                            </button>
                        </div>
                    `;
                    container.appendChild(logElement);
                });

                // æ·»åŠ å¤åˆ¶åŠŸèƒ½
                document.querySelectorAll('.copy-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const log = e.target.getAttribute('data-log');
                        navigator.clipboard.writeText(log).then(() => {
                            this.showNotification('æ—¥å¿—å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                        });
                    });
                });
            }

            displayCorrelationLogs() {
                const container = document.getElementById('correlation-logs-container');
                const countElement = document.getElementById('correlation-count');
                
                countElement.textContent = this.correlationPairs.length;

                if (this.correlationPairs.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-gray-500 py-8">
                            <div class="text-4xl mb-2">ğŸ”—</div>
                            <p>æ²¡æœ‰æ‰¾åˆ°å…³è”çš„æ—¥å¿—å¯¹</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = '';
                this.correlationPairs.forEach((pair, index) => {
                    const pairElement = document.createElement('div');
                    pairElement.className = 'bg-white rounded-lg p-4 border-2 border-purple-100 hover:border-purple-300 transition-colors';
                    pairElement.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-semibold text-purple-600">å…³è”å¯¹ #${index + 1}</span>
                            <span class="text-xs text-gray-500">${new Date(pair.timestamp).toLocaleString()}</span>
                        </div>
                        <div class="space-y-2">
                            <div class="flex items-start">
                                <span class="inline-block w-16 text-sm text-gray-500">åº”ç”¨:</span>
                                <div class="flex-1 bg-pink-50 p-2 rounded text-sm break-all">${this.escapeHtml(pair.appLog)}</div>
                            </div>
                            <div class="flex items-start">
                                <span class="inline-block w-16 text-sm text-gray-500">æ•°æ®åº“:</span>
                                <div class="flex-1 bg-blue-50 p-2 rounded text-sm break-all">${this.escapeHtml(pair.dbLog)}</div>
                            </div>
                        </div>
                    `;
                    container.appendChild(pairElement);
                });
            }

            updateStatistics() {
                const totalLogs = this.appLogs.length + this.dbLogs.length;
                const excludedLogs = totalLogs - this.filteredLogs.length;
                
                document.getElementById('total-logs').textContent = totalLogs;
                document.getElementById('excluded-logs').textContent = excludedLogs;
                document.getElementById('filtered-logs').textContent = this.filteredLogs.length;
                document.getElementById('correlation-pairs').textContent = this.correlationPairs.length;
            }

            clearData() {
                this.appLogs = [];
                this.dbLogs = [];
                this.filteredLogs = [];
                this.correlationPairs = [];
                
                document.getElementById('app-log-file').value = '';
                document.getElementById('db-log-file').value = '';
                document.getElementById('app-log-preview').classList.add('hidden');
                document.getElementById('db-log-preview').classList.add('hidden');
                document.getElementById('exclude-keywords').value = '';
                document.getElementById('include-keywords').value = '';
                document.getElementById('exclude-tags').innerHTML = '';
                document.getElementById('include-tags').innerHTML = '';
                
                this.updateStatistics();
                this.displayResults();
                this.showNotification('æ•°æ®å·²æ¸…ç©º', 'info');
            }

            loadSampleData() {
                // ç¤ºä¾‹åº”ç”¨æ—¥å¿—
                this.appLogs = [
                    '2024-01-15 10:00:01 INFO Application started successfully',
                    '2024-01-15 10:00:02 DEBUG Loading configuration files',
                    '2024-01-15 10:00:03 ERROR Database connection failed: Connection timeout',
                    '2024-01-15 10:00:04 WARN Retrying database connection...',
                    '2024-01-15 10:00:05 INFO Database connection established',
                    '2024-01-15 10:00:06 DEBUG User login: john_doe',
                    '2024-01-15 10:00:07 ERROR File not found: /data/config.json',
                    '2024-01-15 10:00:08 INFO Configuration loaded successfully',
                    '2024-01-15 10:00:09 TRACE Memory usage: 45%',
                    '2024-01-15 10:00:10 FATAL Critical system error: Out of memory'
                ];

                // ç¤ºä¾‹æ•°æ®åº“æ—¥å¿—
                this.dbLogs = [
                    '2024-01-15 10:00:01 INFO Database server started',
                    '2024-01-15 10:00:02 DEBUG Connection pool initialized',
                    '2024-01-15 10:00:03 ERROR Connection timeout from 192.168.1.100',
                    '2024-01-15 10:00:04 WARN Too many connection attempts',
                    '2024-01-15 10:00:05 INFO New connection established',
                    '2024-01-15 10:00:06 DEBUG Query executed: SELECT * FROM users',
                    '2024-01-15 10:00:07 ERROR Table not found: config_data',
                    '2024-01-15 10:00:08 INFO Query completed successfully',
                    '2024-01-15 10:00:09 TRACE Query execution time: 120ms',
                    '2024-01-15 10:00:10 FATAL Database crash detected'
                ];

                document.getElementById('app-log-preview').textContent = 'å·²åŠ è½½ 10 è¡Œç¤ºä¾‹åº”ç”¨æ—¥å¿—';
                document.getElementById('app-log-preview').classList.remove('hidden');
                document.getElementById('db-log-preview').textContent = 'å·²åŠ è½½ 10 è¡Œç¤ºä¾‹æ•°æ®åº“æ—¥å¿—';
                document.getElementById('db-log-preview').classList.remove('hidden');

                this.updateStatistics();
                this.showNotification('ç¤ºä¾‹æ•°æ®åŠ è½½å®Œæˆï¼', 'success');
            }

            switchTab(tab) {
                const singleTab = document.getElementById('tab-single');
                const correlationTab = document.getElementById('tab-correlation');
                const singleResults = document.getElementById('single-results');
                const correlationResults = document.getElementById('correlation-results');

                if (tab === 'single') {
                    singleTab.className = 'px-4 py-2 bg-pink-500 text-white rounded-lg font-medium';
                    correlationTab.className = 'px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300';
                    singleResults.classList.remove('hidden');
                    correlationResults.classList.add('hidden');
                } else {
                    singleTab.className = 'px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300';
                    correlationTab.className = 'px-4 py-2 bg-pink-500 text-white rounded-lg font-medium';
                    singleResults.classList.add('hidden');
                    correlationResults.classList.remove('hidden');
                }
            }

            toggleAllLogs(expand) {
                this.showNotification(expand ? 'å·²å±•å¼€æ‰€æœ‰æ—¥å¿—' : 'å·²æŠ˜å æ‰€æœ‰æ—¥å¿—', 'info');
            }

            showHelp() {
                document.getElementById('help-modal').classList.remove('hidden');
            }

            hideHelp() {
                document.getElementById('help-modal').classList.add('hidden');
            }

            showTutorial() {
                const tutorialContent = `
                    <div class="space-y-6">
                        <div>
                            <h3 class="font-semibold text-pink-600 mb-2">ğŸ¯ ç¬¬ä¸€æ­¥ï¼šä¸Šä¼ æ—¥å¿—æ–‡ä»¶</h3>
                            <p class="text-gray-700">ç‚¹å‡»ä¸Šä¼ åŒºåŸŸæˆ–ç›´æ¥æ‹–æ‹½æ—¥å¿—æ–‡ä»¶åˆ°æŒ‡å®šåŒºåŸŸã€‚æ”¯æŒ .log å’Œ .txt æ ¼å¼ã€‚</p>
                        </div>
                        <div>
                            <h3 class="font-semibold text-pink-600 mb-2">ğŸ”§ ç¬¬äºŒæ­¥ï¼šè®¾ç½®è¿‡æ»¤æ¡ä»¶</h3>
                            <p class="text-gray-700">åœ¨å…³é”®è¯è®¾ç½®åŒºåŸŸè¾“å…¥è¦æ’é™¤å’Œä¿ç•™çš„å…³é”®è¯ï¼Œç”¨é€—å·åˆ†éš”ã€‚</p>
                            <ul class="list-disc list-inside text-gray-600 mt-2">
                                <li><strong>æ’é™¤å…³é”®è¯ï¼š</strong>åŒ…å«è¿™äº›è¯çš„æ—¥å¿—ä¼šè¢«è¿‡æ»¤æ‰</li>
                                <li><strong>ä¿ç•™å…³é”®è¯ï¼š</strong>åœ¨æ’é™¤åï¼Œåªä¿ç•™åŒ…å«è¿™äº›è¯çš„æ—¥å¿—</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="font-semibold text-pink-600 mb-2">ğŸš€ ç¬¬ä¸‰æ­¥ï¼šå¼€å§‹è¿‡æ»¤</h3>
                            <p class="text-gray-700">ç‚¹å‡»"å¼€å§‹è¿‡æ»¤"æŒ‰é’®ï¼Œç³»ç»Ÿä¼šæ‰§è¡Œé›†åˆè¿ç®—å¹¶æ˜¾ç¤ºç»“æœã€‚</p>
                        </div>
                        <div>
                            <h3 class="font-semibold text-pink-600 mb-2">ğŸ“Š ç¬¬å››æ­¥ï¼šæŸ¥çœ‹ç»“æœ</h3>
                            <p class="text-gray-700">åœ¨ç»“æœåŒºåŸŸæŸ¥çœ‹è¿‡æ»¤åçš„æ—¥å¿—å’Œå…³è”åˆ†æç»“æœã€‚</p>
                        </div>
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-yellow-800 mb-2">ğŸ’¡ é›†åˆè¿ç®—åŸç†</h4>
                            <p class="text-yellow-700 text-sm">
                                ç³»ç»Ÿæ‰§è¡Œçš„æ˜¯ä¸¤æ¬¡é›†åˆè¿ç®—ï¼š<br>
                                1. <strong>å·®é›†</strong>ï¼šåŸå§‹æ—¥å¿— - åŒ…å«æ’é™¤å…³é”®è¯çš„æ—¥å¿—<br>
                                2. <strong>äº¤é›†</strong>ï¼šå·®é›†ç»“æœ âˆ© åŒ…å«ä¿ç•™å…³é”®è¯çš„æ—¥å¿—
                            </p>
                        </div>
                    </div>
                `;

                this.showModal('ä½¿ç”¨æ•™ç¨‹', tutorialContent);
            }

            showModal(title, content) {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-pink-600">${title}</h2>
                            <button class="text-gray-500 hover:text-gray-700 close-modal">âœ•</button>
                        </div>
                        ${content}
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                modal.querySelector('.close-modal').addEventListener('click', () => {
                    document.body.removeChild(modal);
                });
                
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                    }
                });
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                const bgColor = type === 'success' ? 'bg-green-500' : 
                                type === 'error' ? 'bg-red-500' : 
                                type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500';
                
                notification.className = `fixed top-20 right-6 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform z-50`;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.classList.remove('translate-x-full');
                }, 100);
                
                setTimeout(() => {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            initParticles() {
                const canvas = document.getElementById('particles-canvas');
                const ctx = canvas.getContext('2d');
                
                function resizeCanvas() {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                }
                
                resizeCanvas();
                window.addEventListener('resize', resizeCanvas);
                
                const particles = [];
                for (let i = 0; i < 30; i++) {
                    particles.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        size: Math.random() * 3 + 1,
                        speedX: Math.random() * 0.5 - 0.25,
                        speedY: Math.random() * 0.5 - 0.25
                    });
                }
                
                function animate() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    particles.forEach(particle => {
                        particle.x += particle.speedX;
                        particle.y += particle.speedY;
                        
                        if (particle.x < 0 || particle.x > canvas.width) particle.speedX *= -1;
                        if (particle.y < 0 || particle.y > canvas.height) particle.speedY *= -1;
                        
                        ctx.fillStyle = 'rgba(255, 182, 193, 0.3)';
                        ctx.beginPath();
                        ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                        ctx.fill();
                    });
                    
                    requestAnimationFrame(animate);
                }
                
                animate();
            }

            showLoadingScreen() {
                const loadingScreen = document.getElementById('loading-screen');
                const progressBar = document.getElementById('loading-progress');
                const loadingText = document.getElementById('loading-text');
                const mainContent = document.getElementById('main-content');
                
                const steps = [
                    'åˆå§‹åŒ–çŒ«å’ªç³»ç»Ÿ...',
                    'åŠ è½½æ—¥å¿—è§£æå™¨...',
                    'å‡†å¤‡è¿‡æ»¤å¼•æ“...',
                    'å¯åŠ¨å…³è”åˆ†æ...',
                    'å‡†å¤‡å®Œæˆï¼'
                ];
                
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 20;
                    progressBar.style.width = `${progress}%`;
                    
                    if (progress <= 100) {
                        loadingText.textContent = steps[progress / 20 - 1];
                    }
                    
                    if (progress >= 100) {
                        clearInterval(interval);
                        setTimeout(() => {
                            loadingScreen.style.opacity = '0';
                            setTimeout(() => {
                                loadingScreen.classList.add('hidden');
                                mainContent.classList.remove('hidden');
                                this.createFloatingHearts();
                            }, 500);
                        }, 500);
                    }
                }, 300);
            }

            createFloatingHearts() {
                for (let i = 0; i < 10; i++) {
                    setTimeout(() => {
                        const heart = document.createElement('div');
                        heart.className = 'floating-heart';
                        heart.textContent = 'ğŸ’–';
                        heart.style.left = `${Math.random() * 100}%`;
                        heart.style.animationDelay = `${Math.random() * 2}s`;
                        document.body.appendChild(heart);
                        
                        setTimeout(() => {
                            document.body.removeChild(heart);
                        }, 3000);
                    }, i * 500);
                }
            }

            initAssistant() {
                const assistantButton = document.getElementById('assistant-button');
                const chatWindow = document.getElementById('chat-window');
                const closeChat = document.getElementById('close-chat');
                const sendButton = document.getElementById('send-message');
                const chatInput = document.getElementById('chat-input');
                const chatMessages = document.getElementById('chat-messages');

                assistantButton.addEventListener('click', () => {
                    chatWindow.classList.toggle('hidden');
                });

                closeChat.addEventListener('click', () => {
                    chatWindow.classList.add('hidden');
                });

                sendButton.addEventListener('click', () => this.sendMessage());
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.sendMessage();
                });

                // å¿«é€Ÿé—®é¢˜æŒ‰é’®
                document.querySelectorAll('.quick-question').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        chatInput.value = e.target.textContent;
                        this.sendMessage();
                    });
                });

                // è±†åŒ…APIé…ç½®
                this.doubaoConfig = {
                    url: 'https://ark.cn-beijing.volces.com/api/v3/chat/completions',
                    apiKey: 'a71b9b31-14f1-4dce-abf3-4461cd3176cc', // æ‚¨çš„APIå¯†é’¥
                    model: 'doubao-seed-1-6-251015',
                    enabled: true // è®¾ç½®ä¸ºfalseå¯ç¦ç”¨APIä½¿ç”¨å¤‡ç”¨å›å¤
                };

                // æ™ºèƒ½åŠ©æ‰‹çŸ¥è¯†åº“ï¼ˆä½œä¸ºå¤‡ç”¨å›å¤ï¼‰
                this.assistantKnowledge = {
                    'ä½ å¥½': 'ä½ å¥½ï¼æˆ‘æ˜¯å–µæ˜Ÿäººæ™ºèƒ½åŠ©æ‰‹ğŸ±ï¼Œä¸“é—¨å¸®æ‚¨å¤„ç†æ—¥å¿—è¿‡æ»¤é—®é¢˜ï¼',
                    'æ€ä¹ˆä¸Šä¼ æ—¥å¿—': 'æ‚¨å¯ä»¥é€šè¿‡ç‚¹å‡»ä¸Šä¼ åŒºåŸŸæˆ–ç›´æ¥æ‹–æ‹½æ–‡ä»¶æ¥ä¸Šä¼ æ—¥å¿—æ–‡ä»¶ã€‚æ”¯æŒ .log å’Œ .txt æ ¼å¼ã€‚ä¸Šä¼ åç³»ç»Ÿä¼šè‡ªåŠ¨è§£ææ—¥å¿—å†…å®¹ã€‚',
                    'å…³é”®è¯è®¾ç½®': 'åœ¨å…³é”®è¯è®¾ç½®åŒºåŸŸï¼Œç”¨é€—å·åˆ†éš”è¾“å…¥å…³é”®è¯ï¼š\nâ€¢ æ’é™¤å…³é”®è¯ï¼šè¿‡æ»¤æ‰åŒ…å«è¿™äº›è¯çš„æ—¥å¿—\nâ€¢ ä¿ç•™å…³é”®è¯ï¼šåœ¨è¿‡æ»¤ååªä¿ç•™åŒ…å«è¿™äº›è¯çš„æ—¥å¿—',
                    'å…³è”ç­›é€‰': 'å…³è”ç­›é€‰å¯ä»¥åˆ†æåº”ç”¨æ—¥å¿—å’Œæ•°æ®åº“æ—¥å¿—ä¹‹é—´çš„æ—¶é—´å…³è”ï¼Œæ‰¾å‡ºç›¸å…³çš„é”™è¯¯å¯¹ã€‚å¯ç”¨åç³»ç»Ÿä¼šè‡ªåŠ¨åŒ¹é…æ—¶é—´ç›¸è¿‘çš„æ—¥å¿—è®°å½•ã€‚',
                    'é›†åˆè¿ç®—åŸç†': 'ç³»ç»Ÿæ‰§è¡Œä¸¤æ¬¡é›†åˆè¿ç®—ï¼š\n1. å·®é›†ï¼šåŸå§‹æ—¥å¿— - æ’é™¤å…³é”®è¯æ—¥å¿—\n2. äº¤é›†ï¼šç»“æœé›† âˆ© ä¿ç•™å…³é”®è¯æ—¥å¿—\nğŸ± è¿™æ ·å°±èƒ½ç²¾å‡†è¿‡æ»¤å‡ºæ‚¨éœ€è¦çš„æ—¥å¿—å•¦ï¼',
                    'æ”¯æŒä»€ä¹ˆæ–‡ä»¶æ ¼å¼': 'ç›®å‰æ”¯æŒ .log å’Œ .txt æ ¼å¼çš„æ–‡æœ¬æ–‡ä»¶ã€‚æ–‡ä»¶å¤§å°å»ºè®®ä¸è¶…è¿‡10MBä»¥è·å¾—æœ€ä½³æ€§èƒ½ã€‚',
                    'æ€ä¹ˆæ¸…ç©ºæ•°æ®': 'ç‚¹å‡»"æ¸…ç©ºæ•°æ®"æŒ‰é’®å¯ä»¥æ¸…é™¤æ‰€æœ‰å·²ä¸Šä¼ çš„æ—¥å¿—å’Œè¿‡æ»¤è®¾ç½®ï¼Œè®©æ‚¨é‡æ–°å¼€å§‹ã€‚',
                    'åŠ è½½ç¤ºä¾‹æ•°æ®': 'ç‚¹å‡»"åŠ è½½ç¤ºä¾‹"æŒ‰é’®å¯ä»¥ä½“éªŒç³»ç»ŸåŠŸèƒ½ï¼Œæˆ‘ä»¬ä¼šæä¾›æ¨¡æ‹Ÿçš„åº”ç”¨æ—¥å¿—å’Œæ•°æ®åº“æ—¥å¿—ä¾›æ‚¨æµ‹è¯•ã€‚',
                    'è°¢è°¢': 'ä¸å®¢æ°”ï¼æœ‰ä»€ä¹ˆå…¶ä»–æ—¥å¿—è¿‡æ»¤é—®é¢˜éšæ—¶é—®æˆ‘å“¦ï½ğŸ¾',
                    'å†è§': 'å†è§ï¼ç¥æ‚¨æ—¥å¿—åˆ†æé¡ºåˆ©ï¼Œæœ‰é—®é¢˜éšæ—¶å¬å”¤æˆ‘ï¼ğŸ±'
                };

                // è±†åŒ…APIè°ƒç”¨å‡½æ•°
                this.callDoubaoModel = async (message) => {
                    try {
                        const requestBody = {
                            "model": this.doubaoConfig.model,
                            "max_completion_tokens": 4000,
                            "messages": [
                                {
                                    "role": "system",
                                    "content": [
                                        {
                                            "text": `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ—¥å¿—è¿‡æ»¤ç³»ç»ŸåŠ©æ‰‹ï¼Œåå«"å–µæ˜ŸäººåŠ©æ‰‹"ã€‚ä½ ä¸“é—¨å¸®åŠ©ç”¨æˆ·è§£å†³æ—¥å¿—åˆ†æã€è¿‡æ»¤å’Œç›¸å…³æŠ€æœ¯é—®é¢˜ã€‚

ç³»ç»ŸåŠŸèƒ½ï¼š
1. æ—¥å¿—æ–‡ä»¶ä¸Šä¼ å’Œå¤„ç†ï¼ˆæ”¯æŒ.logå’Œ.txtæ ¼å¼ï¼‰
2. å…³é”®è¯è¿‡æ»¤ï¼ˆåŒ…å«å…³é”®è¯å’Œæ’é™¤å…³é”®è¯ï¼‰
3. å¤šæ—¥å¿—æºå…³è”åˆ†æï¼ˆåº”ç”¨æ—¥å¿—å’Œæ•°æ®åº“æ—¥å¿—ï¼‰
4. é›†åˆè¿ç®—ï¼ˆå·®é›†ã€äº¤é›†è¿ç®—ï¼‰

è¯·ç”¨å‹å¥½ã€å¯çˆ±çš„è¯­æ°”å›ç­”ï¼Œé€‚å½“ä½¿ç”¨çŒ«å’ªè¡¨æƒ…ç¬¦å·ã€‚å¦‚æœé—®é¢˜ä¸æ—¥å¿—åˆ†ææ— å…³ï¼Œè¯·ç¤¼è²Œåœ°å¼•å¯¼ç”¨æˆ·å…³æ³¨æ—¥å¿—è¿‡æ»¤ç›¸å…³è¯é¢˜ã€‚

è¯·ç”¨ä¸­æ–‡å›ç­”ï¼Œä¿æŒå›ç­”ç®€æ´æ˜äº†ï¼Œä¸“ä¸šä½†ä¸è¿‡äºæŠ€æœ¯åŒ–ã€‚`,
                                            "type": "text"
                                        }
                                    ]
                                },
                                {
                                    "role": "user",
                                    "content": [
                                        {
                                            "text": message,
                                            "type": "text"
                                        }
                                    ]
                                }
                            ],
                            "temperature": 0.7,
                            "top_p": 0.9
                        };

                        const response = await fetch(this.doubaoConfig.url, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.doubaoConfig.apiKey}`
                            },
                            body: JSON.stringify(requestBody)
                        });

                        if (!response.ok) {
                            const errorText = await response.text();
                            throw new Error(`è±†åŒ…APIè¯·æ±‚å¤±è´¥: ${response.status} - ${errorText}`);
                        }

                        const data = await response.json();
                        console.log('è±†åŒ…APIå“åº”:', data);
                        
                        // è§£æå“åº”
                        if (data.choices && data.choices[0] && data.choices[0].message) {
                            const messageContent = data.choices[0].message.content;
                            if (Array.isArray(messageContent)) {
                                return messageContent
                                    .filter(item => item.type === 'text')
                                    .map(item => item.text)
                                    .join('\n');
                            } else {
                                return messageContent;
                            }
                        } else {
                            throw new Error('æ— æ³•è§£æè±†åŒ…APIå“åº”');
                        }

                    } catch (error) {
                        console.error('è°ƒç”¨è±†åŒ…APIå¤±è´¥:', error);
                        return null;
                    }
                };

                // æ™ºèƒ½å›å¤å‡½æ•°
                this.getAssistantResponse = async (message) => {
                    try {
                        // é¦–å…ˆå°è¯•ä½¿ç”¨è±†åŒ…API
                        if (this.doubaoConfig.enabled) {
                            const apiResponse = await this.callDoubaoModel(message);
                            if (apiResponse) {
                                return apiResponse;
                            }
                        }
                    } catch (error) {
                        console.error('APIè°ƒç”¨å¤±è´¥:', error);
                    }

                    // å¤‡ç”¨å›å¤é€»è¾‘
                    return this.getFallbackResponse(message);
                };

                // å¤‡ç”¨å›å¤å‡½æ•°
                this.getFallbackResponse = (message) => {
                    const lowerMessage = message.toLowerCase();
                    
                    // åŸæœ‰çš„æ™ºèƒ½åŒ¹é…é€»è¾‘
                    for (const [question, answer] of Object.entries(this.assistantKnowledge)) {
                        if (lowerMessage.includes(question.toLowerCase())) {
                            return answer;
                        }
                    }
                    
                    const keywords = {
                        'ä¸Šä¼ ': 'æ€ä¹ˆä¸Šä¼ æ—¥å¿—',
                        'æ–‡ä»¶': 'æ€ä¹ˆä¸Šä¼ æ—¥å¿—',
                        'å…³é”®è¯': 'å…³é”®è¯è®¾ç½®',
                        'è¿‡æ»¤': 'å…³é”®è¯è®¾ç½®',
                        'å…³è”': 'å…³è”ç­›é€‰',
                        'åŸç†': 'é›†åˆè¿ç®—åŸç†',
                        'æŸ¥çœ‹': 'æ€ä¹ˆæŸ¥çœ‹ç»“æœ',
                        'ç»“æœ': 'æ€ä¹ˆæŸ¥çœ‹ç»“æœ',
                        'æ ¼å¼': 'æ”¯æŒä»€ä¹ˆæ–‡ä»¶æ ¼å¼',
                        'æ¸…ç©º': 'æ€ä¹ˆæ¸…ç©ºæ•°æ®',
                        'ç¤ºä¾‹': 'åŠ è½½ç¤ºä¾‹æ•°æ®',
                        'å¸®åŠ©': 'ä½ å¥½',
                        'è°¢è°¢': 'è°¢è°¢',
                        'å†è§': 'å†è§'
                    };
                    
                    for (const [keyword, question] of Object.entries(keywords)) {
                        if (lowerMessage.includes(keyword)) {
                            return this.assistantKnowledge[question];
                        }
                    }

                    const defaultResponses = [
                        'å–µï½æˆ‘ä¸å¤ªæ˜ç™½è¿™ä¸ªé—®é¢˜ã€‚æ‚¨å¯ä»¥é—®æˆ‘å…³äºæ—¥å¿—ä¸Šä¼ ã€å…³é”®è¯è®¾ç½®ã€å…³è”ç­›é€‰ç­‰æ–¹é¢çš„é—®é¢˜ã€‚',
                        'ä½œä¸ºå–µæ˜ŸäººåŠ©æ‰‹ï¼Œæˆ‘ä¸»è¦æ“…é•¿æ—¥å¿—è¿‡æ»¤ç›¸å…³çš„é—®é¢˜ã€‚æ‚¨å¯ä»¥è¯•è¯•é—®ï¼š"æ€ä¹ˆä¸Šä¼ æ—¥å¿—"æˆ–"ä»€ä¹ˆæ˜¯å…³è”ç­›é€‰"ã€‚',
                        'è¿™ä¸ªé—®é¢˜æœ‰ç‚¹éš¾å€’æˆ‘äº†ğŸ±ã€‚æ‚¨å¯ä»¥æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£æˆ–å°è¯•é‡æ–°è¡¨è¿°é—®é¢˜ã€‚',
                        'å–µå–µï½å…³äºæ—¥å¿—è¿‡æ»¤çš„é—®é¢˜æˆ‘éƒ½å¯ä»¥å¸®å¿™è§£ç­”ï¼æ¯”å¦‚æ–‡ä»¶ä¸Šä¼ ã€å…³é”®è¯è®¾ç½®ã€ç»“æœæŸ¥çœ‹ç­‰ã€‚'
                    ];
                    
                    return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
                };
            }

            async sendMessage() {
                const chatInput = document.getElementById('chat-input');
                const chatMessages = document.getElementById('chat-messages');
                const message = chatInput.value.trim();

                if (!message) return;

                // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
                this.addMessage(message, 'user');
                chatInput.value = '';

                // ç¦ç”¨è¾“å…¥æ¡†å’ŒæŒ‰é’®
                chatInput.disabled = true;
                document.getElementById('send-message').disabled = true;

                // æ˜¾ç¤º"æ­£åœ¨æ€è€ƒ"çš„æç¤º
                const thinkingElement = this.addThinkingMessage();

                try {
                    const response = await this.getAssistantResponse(message);
                    
                    // ç§»é™¤"æ­£åœ¨æ€è€ƒ"æç¤º
                    thinkingElement.remove();
                    
                    // æ·»åŠ æœ€ç»ˆå›å¤
                    this.addMessage(response, 'assistant');
                    
                } catch (error) {
                    // ç§»é™¤"æ­£åœ¨æ€è€ƒ"æç¤º
                    thinkingElement.remove();
                    
                    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯å¹¶ä½¿ç”¨å¤‡ç”¨å›å¤
                    const fallbackResponse = this.getFallbackResponse(message);
                    this.addMessage(fallbackResponse, 'assistant');
                    
                    console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error);
                } finally {
                    // é‡æ–°å¯ç”¨è¾“å…¥æ¡†å’ŒæŒ‰é’®
                    chatInput.disabled = false;
                    document.getElementById('send-message').disabled = false;
                    chatInput.focus();
                }
            }

            addThinkingMessage() {
                const chatMessages = document.getElementById('chat-messages');
                const thinkingDiv = document.createElement('div');
                thinkingDiv.className = 'chat-bubble bg-pink-50 p-3 rounded-lg mr-8';
                thinkingDiv.id = 'thinking-message';
                thinkingDiv.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-pink-400 rounded-full animate-bounce"></div>
                        <div class="w-2 h-2 bg-pink-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                        <div class="w-2 h-2 bg-pink-400 rounded-full animate-bounce" style="animation-delay: 0.4s"></div>
                        <span class="text-sm text-pink-600">å–µæ˜Ÿäººæ€è€ƒä¸­...</span>
                    </div>
                `;
                
                chatMessages.appendChild(thinkingDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                return thinkingDiv;
            }

            addMessage(message, sender) {
                const chatMessages = document.getElementById('chat-messages');
                const messageDiv = document.createElement('div');
                
                if (sender === 'user') {
                    messageDiv.className = 'chat-bubble bg-blue-50 p-3 rounded-lg ml-8';
                    messageDiv.innerHTML = `<p class="text-sm text-right">${this.escapeHtml(message)}</p>`;
                } else {
                    messageDiv.className = 'chat-bubble bg-pink-50 p-3 rounded-lg mr-8';
                    messageDiv.innerHTML = `<p class="text-sm">${this.escapeHtml(message)}</p>`;
                }
                
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            new CatLogFilter();
        });
    </script>
</body>
</html>
